<div class="admin-page">
    <div class="background-decor"></div>

    <div class="admin-container">
        <!-- Header -->
        <header class="admin-header">
            <div class="title-section">
                <span class="admin-badge">Management Portal</span>
                <h1>Admin Dashboard</h1>
                <p>Welcome, <strong>&#64;{{ user?.username }}</strong>. System oversight active.</p>
            </div>

            <div class="header-actions">
                <a routerLink="/admin/review" class="review-queue-btn" routerLinkActive="active">
                    <span class="count" *ngIf="stats?.pending_review > 0">{{ stats.pending_review }}</span>
                    Review Queue
                </a>
                <button class="refresh-btn" (click)="fetchStats()" [class.loading]="loading">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6"></path>
                        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"></path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Loading State -->
        <div *ngIf="loading && !stats" class="loader-container">
            <div class="pulse-loader"></div>
            <p>Syncing analytics...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="error" class="error-panel">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ff4757" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <h3>Connection Issue</h3>
            <p>{{ error }}</p>
            <button (click)="fetchStats()" class="btn-primary">Retry</button>
        </div>

        <!-- Dashboard Content -->
        <div *ngIf="stats" class="dashboard-content fade-in">
            <!-- Stats Overview Cards -->
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-icon users">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 00-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 010 7.75"></path>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Total Users</span>
                        <span class="stat-value">{{ stats.total_users }}</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon posts">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Total Posts</span>
                        <span class="stat-value">{{ stats.total_posts }}</span>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-icon reviews">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path
                                d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z">
                            </path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Need Review</span>
                        <span class="stat-value">{{ stats.pending_review }}</span>
                    </div>
                </div>
            </div>

            <!-- Main Grid: Tables and History -->
            <div class="main-grid">
                <!-- User Table -->
                <div class="table-section">
                    <div class="section-header">
                        <h3>Contributor Activity</h3>
                        <p>Detailed performance by username</p>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Today</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let u of stats.users">
                                    <td>
                                        <div class="user-cell">
                                            <div class="avatar-sm">
                                                <img *ngIf="u.profile_pic" [src]="u.profile_pic" [alt]="u.username"
                                                    class="table-profile-img">
                                                <ng-container *ngIf="!u.profile_pic">{{
                                                    u.username.charAt(0).toUpperCase() }}</ng-container>
                                            </div>
                                            <span class="username">{{ u.username }}</span>
                                        </div>
                                    </td>
                                    <td><span class="role-badge" [class.admin]="u.role === 'admin'">{{ u.role }}</span>
                                    </td>
                                    <td class="status-dot-center-on-mobile">
                                        <span class="status-dot" [class.active]="!u.is_blocked"
                                            [class.blocked]="u.is_blocked"></span>
                                        <span class="status-text">{{ u.is_blocked ? 'Blocked' : 'Active' }}</span>
                                    </td>
                                    <td class="center-text"><span class="pill-count">{{ u.posts_today }}</span></td>
                                    <td class="center-text"><strong>{{ u.total_posts_published }}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Daily Stats Component -->
                <div class="history-section">
                    <app-daily-stats></app-daily-stats>
                </div>
            </div>
        </div>
    </div>
</div>